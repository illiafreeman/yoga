{"version":3,"sources":["../assets/scripts/video-player.js"],"names":["YahVideoPlayer","previewLength","isVideoFree","flagged","percent","logId","videoId","videoContent","videoContentVolume","videoContentFullScreen","eventType","journeySeriesDayData","jQuery","data","activityNonce","videoEnable","updateVideoActivity","ajax","type","url","yahAjax","ajaxurl","dataType","action","asset_id","log_id","js_day_data","nonce","success","res","journeyUpdated","addClass","playingVideo","volume","fullscreen","event_type","initializePlayer","repoId","isFree","parseInt","console","log","videoRefName","videoTplId","$videoCont","videojs","html","append","$","attr","brightcovePlayerLoader","refNode","refNodeInsert","accountId","yahVideo","playerAccountId","playerId","embedId","embedOptions","responsive","then","player","ref","id_","window","getPlayer","on","hide","e","Math","round","params","event","session_id","session","content_asset_id","video","content_pod_id","title","video_data","name","description","keywords","tags","season","episode","genre","player_name","ad_enabled","ads_enabled","program","publisher","position","total_length","duration","channel","full_episode","livestream","airdate","createdAt","bitrate","sources","avg_bitrate","framerate","pos","this","currentTime","videoPlayer","pause","show","dispose"],"mappings":"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","file":"video-player.js","sourcesContent":["YahVideoPlayer = {\n    previewLength: 0,\n    isVideoFree: 0,\n    flagged: false,\n    percent: 0,\n    logId: 0,\n    videoId: '',\n    videoContent: {},\n    videoContentVolume: 100,\n    videoContentFullScreen: false,\n    eventType: '',\n    journeySeriesDayData: jQuery('#featured-video-meta').data('conn-id'),\n    activityNonce: null,\n    videoEnable: false,\n    updateVideoActivity: function (videoId, percent) {\n        jQuery.ajax({\n            type: 'POST',\n            url: yahAjax.ajaxurl,\n            dataType: 'json',\n            data: {\n                action: 'video_played',\n                asset_id: videoId,\n                percent: percent,\n                log_id: YahVideoPlayer.logId,\n                js_day_data: YahVideoPlayer.journeySeriesDayData,\n                nonce: YahVideoPlayer.activityNonce\n            },\n            success: function (res) {\n                YahVideoPlayer.logId = res.data.logId;\n                if (res.data.journeyUpdated) {\n                    jQuery('[data-js-day-watched=\"' + YahVideoPlayer.journeySeriesDayData + '\"]').addClass('watched');\n                }\n            }\n        });\n    },\n\n    playingVideo: function (data) {\n        jQuery.ajax({\n            type: 'POST',\n            url: yahAjax.ajaxurl,\n            dataType: 'json',\n            data: {\n                action: 'segment_video_stats',\n                data: data.videoContent,\n                asset_id: data.videoId,\n                volume: YahVideoPlayer.videoContentVolume,\n                fullscreen: YahVideoPlayer.videoContentFullScreen,\n                event_type: YahVideoPlayer.eventType,\n                nonce: YahVideoPlayer.activityNonce\n            },\n        });\n    },\n    initializePlayer: function (videoId, repoId, isFree) {\n        YahVideoPlayer.videoId = videoId;\n        YahVideoPlayer.isVideoFree = parseInt(isFree);\n\n        console.log(\"Initializing Video #\" + videoId);\n\n        var\n            videoTplId = 'video-player',\n            videoRefName = '',\n            $videoCont = jQuery('#featured-video-cont');\n            // timerId,\n            //\n            // // throttle function to sean a request once in a time\n            // throttleFunction = function (func, delay) {\n            //     // If setTimeout is already scheduled, no need to do anything\n            //     if (timerId) {\n            //         return;\n            //     }\n            //\n            //     // Schedule a setTimeout after delay seconds\n            //     timerId = setTimeout(function () {\n            //         func();\n            //\n            //         // Once setTimeout function execution is finished, timerId = undefined so that in <br>\n            //         // the next scroll event function execution can be scheduled by the setTimeout\n            //         timerId = undefined;\n            //     }, delay);\n            // };\n\n\n        if (typeof videojs !== 'undefined') {\n            $videoCont.html('').append($('<div/>').attr('id', videoTplId));\n\n            brightcovePlayerLoader({\n                refNode: '#' + videoTplId,\n                refNodeInsert: 'replace',\n                accountId: yahVideo.playerAccountId,\n                playerId: yahVideo.playerId,\n                embedId: 'default',\n                videoId: repoId,\n                embedOptions: {\n                    responsive: true\n                }\n            }).then(function (player) {\n                videoRefName = player.ref.id_;\n\n                window.videojs.getPlayer(videoRefName).on('loadedmetadata', function () {\n                    console.log('Video #' + videoId + ' was loaded!');\n                    jQuery('.vjs-dock-text').hide();\n                });\n\n                window.videojs.getPlayer(videoRefName).on('analytics_request_fullscreen_enabled', function () {\n                    YahVideoPlayer.videoContentFullScreen = true;\n                });\n\n                window.videojs.getPlayer(videoRefName).on('analytics_request_fullscreen_disabled', function () {\n                    YahVideoPlayer.videoContentFullScreen = false;\n                });\n\n                window.videojs.getPlayer(videoRefName).on('analytics_request_volume_change', function (e) {\n                    YahVideoPlayer.videoContentVolume = Math.round(e.params.volume * 100);\n                    // throttleFunction(function () {\n                    //     YahVideoPlayer.playingVideo(YahVideoPlayer);\n                    // }, 1500);\n                });\n\n\n                window.videojs.getPlayer(videoRefName).on('analytics_request', function (e) {\n                    if (e.params.event === 'play_request') {\n                        YahVideoPlayer.eventType = 'started';\n                        YahVideoPlayer.videoContent = {\n                            'session_id'        : e.params.session,\n                            'content_asset_id'  : e.params.video,\n                            'content_pod_id'    : null,\n                            'title'             : e.params.video_data.name,\n                            'description'       : e.params.video_data.description,\n                            'keywords'          : e.params.tags,\n                            'season'            : null,\n                            'episode'           : null,\n                            'genre'             : null,\n                            'player_name'       : e.params.player,\n                            'ad_enabled'        : e.params.ads_enabled,\n                            'program'           : null,\n                            'publisher'         : null,\n                            'position'          : null,\n                            'total_length'      : e.params.video_data.duration,\n                            'channel'           : null,\n                            'full_episode'      : null,\n                            'livestream'        : false,\n                            'airdate'           : e.params.video_data.createdAt,\n                            'bitrate'           : e.params.video_data.sources[2].avg_bitrate,\n                            'framerate'         : null\n                        };\n\n                        YahVideoPlayer.playingVideo(YahVideoPlayer);\n                    }\n                    // console.log('sent a(n) ' + e.params.event + ' beacon!', e.params);\n                    jQuery('.vjs-dock-text').hide();\n                });\n\n                if (YahVideoPlayer.videoEnable) {\n                    window.videojs.getPlayer(videoRefName).on('timeupdate', function () {\n                        var videoPlayer = this,\n                            pos = videoPlayer.currentTime(),\n                            dur = videoPlayer.duration(),\n                            percent = (pos / dur) * 100,\n                            videoId = YahVideoPlayer.videoId;\n\n                        if (pos > 5 && !YahVideoPlayer.flagged) {\n                            YahVideoPlayer.flagged = true;\n\n                            //Video is considered viewed, report\n                            YahVideoPlayer.updateVideoActivity(videoId, percent);\n                        }\n\n                        if ((percent - YahVideoPlayer.percent) > 2) {\n                            YahVideoPlayer.flagged = false;\n                            YahVideoPlayer.percent = percent;\n                        }\n                    });\n\n                    window.videojs.getPlayer(videoRefName).on('ended', function () {\n                        YahVideoPlayer.eventType = 'completed';\n\n                        YahVideoPlayer.updateVideoActivity(YahVideoPlayer.videoId, 100);\n                        YahVideoPlayer.playingVideo(YahVideoPlayer);\n                    });\n                } else {\n                    window.videojs.getPlayer(videoRefName).on('timeupdate', function () {\n                        var videoPlayer = this,\n                            pos = videoPlayer.currentTime();\n\n                        if (pos > YahVideoPlayer.previewLength && YahVideoPlayer.isVideoFree === 0) {\n                            videoPlayer.pause();\n                            jQuery('#preview-end').show();\n                            $videoCont.hide();\n                            videoPlayer.dispose();\n                        }\n                    });\n                }\n            });\n        }\n    }\n};\n"],"sourceRoot":"assets/scripts/"}